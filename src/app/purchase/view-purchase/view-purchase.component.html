<div class="container-fluid py-3" *ngIf="purchase">
  <div class="card">
    <div class="card-header bg-light d-flex justify-content-between align-items-center">
      <h4 class="mb-0">Purchase Details</h4>
      <div>
        <button class="btn btn-sm btn-outline-secondary me-2" (click)="goBack()">
          <i class="fas fa-arrow-left me-1"></i> Back
        </button>
        <button class="btn btn-sm btn-primary me-2" (click)="editPurchase()">
          <i class="fas fa-edit me-1"></i> Edit
        </button>
        <button class="btn btn-sm btn-secondary" (click)="printPurchase()">
          <i class="fas fa-print me-1"></i> Print
        </button>
      </div>
    </div>

    <div class="card-body">
      <div class="row mb-4">
        <div class="col-md-6">
          <div class="mb-3">
            <h5>Purchase Information</h5>
            <table class="table table-sm table-borderless">
              <tbody>
                <tr>
                  <td class="fw-bold" style="width: 120px">Reference No:</td>
                  <td>{{ purchase.referenceNo || 'N/A' }}</td>
                </tr>
                <tr>
                  <td class="fw-bold">Date:</td>
                  <td>{{ purchase.purchaseDate || 'N/A' }}</td>
                </tr>
                <tr>
                  <td class="fw-bold">Status:</td>
                  <td>
                    <span class="badge" 
                          [ngClass]="{
                            'bg-success': purchase.purchaseStatus === 'received',
                            'bg-warning': purchase.purchaseStatus === 'pending',
                            'bg-danger': purchase.purchaseStatus === 'cancelled',
                            'bg-info': !['received', 'pending', 'cancelled'].includes(purchase.purchaseStatus || '')
                          }">
                      {{ purchase.purchaseStatus || 'N/A' }}
                    </span>
                  </td>
                </tr>
                <tr>
                  <td class="fw-bold">Invoice No:</td>
                  <td>{{ purchase.invoiceNo || 'N/A' }}</td>
                </tr>
                <tr>
                  <td class="fw-bold">Payment Status:</td>
                  <td>
                    <span class="badge" 
                          [ngClass]="{
                            'bg-success': purchase.paymentStatus === 'paid',
                            'bg-warning': purchase.paymentStatus === 'partial',
                            'bg-danger': purchase.paymentStatus === 'due',
                            'bg-info': !['paid', 'partial', 'due'].includes(purchase.paymentStatus || '')
                          }">
                      {{ purchase.paymentStatus || 'N/A' }}
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="col-md-6">
          <div class="mb-3">
            <h5>Supplier Information</h5>
            <table class="table table-sm table-borderless">
              <tbody>
             <tr>
          <td class="fw-bold" style="width: 120px">Supplier:</td>
          <td>{{ purchase.supplier || '' }}</td>
     
            <div *ngIf="purchase.supplierAddress">{{ purchase.supplierAddress }}</div>
            <div *ngIf="!purchase.supplierAddress"></div>
        
        </tr>
                <tr>
                  <td class="fw-bold"> Location:</td>
                  <td>{{ purchase.businessLocation || 'N/A' }}</td>
                </tr>
                <tr>
                  <td class="fw-bold">Payment Method:</td>
                  <td>{{ purchase.paymentMethod || 'N/A' }}</td>
                </tr>
                <tr *ngIf="purchase.paymentAccount">
                  <td class="fw-bold">Payment Account:</td>
                  <td>
                    {{ purchase.paymentAccount.name }}
                    <small *ngIf="purchase.paymentAccount.accountNumber" class="text-muted d-block">
                      {{ purchase.paymentAccount.accountNumber }}
                    </small>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="mb-4">
        <h5>Products</h5>
        <div class="table-responsive">
          <table class="table table-bordered">
            <thead class="table-light">
              <tr>
                <th>Product</th>
                <th>Quantity</th>
                <th>Unit Price</th>
                <th>Tax Rate</th>
                <th>Tax Amount</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let product of purchase.products">
                <td>{{ product.name }}</td>
                <td>{{ product.quantity }}</td>
                <td>₹{{ product.price | number:'1.2-2' }}</td>
                <td>{{ product.taxRate }}%</td>
                <td>₹{{ product.taxAmount | number:'1.2-2' }}</td>
                <td>₹{{ product.lineTotal | number:'1.2-2' }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div *ngIf="purchase.additionalNotes">
            <h5>Additional Notes</h5>
            <div class="card">
              <div class="card-body">
                {{ purchase.additionalNotes }}
              </div>
            </div>
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="card">
            <div class="card-header bg-light">
              <h5 class="mb-0">Summary</h5>
            </div>
            <div class="card-body">
              <table class="table table-sm table-borderless">
                <tbody>
                  <tr>
                    <td class="fw-bold text-end">Subtotal:</td>
                    <td class="text-end">₹{{ (purchase.grandTotal! - (purchase.totalTax || 0) - (purchase.shippingCharges || 0)) | number:'1.2-2' }}</td>
                  </tr>
                  <tr class="shipping-row">
                    <td class="fw-bold text-end">Shipping Charges:</td>
                    <td class="text-end">₹{{ purchase.shippingCharges | number:'1.2-2' }}</td>
                  </tr>
                   <tr *ngIf="purchase.isInterState">
                    <td class="fw-bold text-end">IGST:</td>
                    <td class="text-end">₹{{ purchase.igst | number:'1.2-2' }}</td>
                  </tr>
                  <tr *ngIf="!purchase.isInterState">
                    <td class="fw-bold text-end">CGST:</td>
                    <td class="text-end">₹{{ purchase.cgst | number:'1.2-2' }}</td>
                  </tr>
                  <tr *ngIf="!purchase.isInterState">
                    <td class="fw-bold text-end">SGST:</td>
                    <td class="text-end">₹{{ purchase.sgst | number:'1.2-2' }}</td>
                  </tr>
                  <tr>
                    <td class="fw-bold text-end">Total Tax:</td>
                    <td class="text-end">₹{{ purchase.totalTax | number:'1.2-2' }}</td>
                  </tr>
                  <tr>
                    <td class="fw-bold text-end">Grand Total:</td>
                    <td class="text-end fw-bold">₹{{ purchase.grandTotal | number:'1.2-2' }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>