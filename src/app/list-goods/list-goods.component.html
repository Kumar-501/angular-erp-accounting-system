<div class="goods-received-container">
    <div class="header">
      <h2>Goods Received Notes</h2>
      <hr />
    </div>
  
    <div class="filter-controls">
      <div class="date-range">
        <label for="dateRange">Date Range:</label>
        <input type="text" id="dateRange" class="form-control" readonly [value]="formatDateRange()" />
      </div>
      <div class="filter-options">
        <button class="filter-btn" (click)="openFilters()">
          <i class="fa fa-filter"></i> Filters
        </button>
      </div>
    </div>
  
    <div class="view-selector">
      <button [class.active]="currentView === 'all'" (click)="setView('all')">All GRNs</button>
    </div>
  
    <div class="action-bar">
      <div class="entries-control">
        <label for="entries">Show:</label>
        <select id="entries" [(ngModel)]="pageSize" (change)="updatePageSize()">
          <option value="10">10</option>
          <option value="25">25</option>
          <option value="50">50</option>
          <option value="100">100</option>
        </select>
        <span>entries</span>
      </div>
      
      <div class="search-box">
        <label for="search">Search:</label>
        <input type="text" id="search" [(ngModel)]="searchQuery" (input)="applySearch()" class="form-control">
      </div>
      
      <div class="add-button">
        <button class="btn btn-primary" routerLink="/add-grn">
          <i class="fa fa-plus"></i> Add
        </button>
      </div>
    </div>
  
    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr>
            <th>Action</th>
            <th (click)="sortBy('purchaseDate')">Date 
              <i *ngIf="sortColumn === 'purchaseDate'" 
                 [class]="sortDirection === 'asc' ? 'fa fa-arrow-up' : 'fa fa-arrow-down'"></i>
            </th>
            <th (click)="sortBy('referenceNo')">Reference No
              <i *ngIf="sortColumn === 'referenceNo'" 
                 [class]="sortDirection === 'asc' ? 'fa fa-arrow-up' : 'fa fa-arrow-down'"></i>
            </th>
            <th (click)="sortBy('invoiceNo')">Invoice No
              <i *ngIf="sortColumn === 'invoiceNo'" 
                 [class]="sortDirection === 'asc' ? 'fa fa-arrow-up' : 'fa fa-arrow-down'"></i>
            </th>
            <th (click)="sortBy('locationName')">Location
              <i *ngIf="sortColumn === 'locationName'" 
                 [class]="sortDirection === 'asc' ? 'fa fa-arrow-up' : 'fa fa-arrow-down'"></i>
            </th>
            <th (click)="sortBy('supplierName')">Supplier
              <i *ngIf="sortColumn === 'supplierName'" 
                 [class]="sortDirection === 'asc' ? 'fa fa-arrow-up' : 'fa fa-arrow-down'"></i>
            </th>
            <th (click)="sortBy('status')">Purchase Status
              <i *ngIf="sortColumn === 'status'" 
                 [class]="sortDirection === 'asc' ? 'fa fa-arrow-up' : 'fa fa-arrow-down'"></i>
            </th>
            <th (click)="sortBy('addedBy')">Added By
              <i *ngIf="sortColumn === 'addedBy'" 
                 [class]="sortDirection === 'asc' ? 'fa fa-arrow-up' : 'fa fa-arrow-down'"></i>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let grn of paginatedGoodsReceived">
            <td>
              <div class="dropdown">
               <div class="delete-icon-container">
  <button class="delete-btn" (click)="deleteGrn(grn.id)" title="Delete">
    <i class="fas fa-trash"></i>
  </button>
</div>
              </div>
            </td>
            <td>{{ grn.purchaseDate | date:'dd-MM-yyyy HH:mm' }}</td>
            <td>{{ grn.referenceNo || 'N/A' }}</td>
            <td>{{ grn.invoiceNo || 'N/A' }}</td>
            <td>{{ getLocationName(grn) }}</td>
            <td>{{ getSupplierName(grn) }}</td>
            <td>
              <span class="status-badge" [ngClass]="getStatusClass(grn.status)">
                {{ formatStatus(grn.status) }}
              </span>
            </td>
            <td>{{ grn.addedBy || 'N/A' }}</td>
          </tr>
          <tr *ngIf="paginatedGoodsReceived.length === 0">
            <td colspan="8" class="no-data">No data available</td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <div class="pagination-controls">
      <div class="pagination-info">
        Showing {{ startItem }} to {{ endItem }} of {{ filteredGoodsReceived.length }} entries
      </div>
      <div class="pagination-buttons">
        <button [disabled]="currentPage === 1" (click)="previousPage()">Previous</button>
        <button [class.active]="currentPage === page" *ngFor="let page of pageNumbers" (click)="goToPage(page)">
          {{ page }}
        </button>
        <button [disabled]="currentPage === totalPages" (click)="nextPage()">Next</button>
      </div>
    </div>
  </div>
  <!-- Add this modal to your template -->
<div class="modal" *ngIf="selectedGrn">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Products Details - {{selectedGrn.referenceNo}}</h3>
      <span class="close" (click)="selectedGrn = null">&times;</span>
    </div>
    <div class="modal-body">
      <table class="products-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Product Name</th>
            <th>Order Qty</th>
            <th>Received Qty</th>
            <th>Unit Price</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let product of selectedGrn.products; let i = index">
            <td>{{i + 1}}</td>
            <td>{{product.productName || product.name}}</td>
            <td>{{product.orderQuantity || 0}}</td>
            <td>{{product.quantity || product.receivedQuantity || 0}}</td>
            <td>{{product.unitCost || product.unitPrice | currency:'INR':'symbol':'1.2-2'}}</td>
            <td>{{product.lineTotal | currency:'INR':'symbol':'1.2-2'}}</td>
          </tr>
          <tr *ngIf="!selectedGrn.products || selectedGrn.products.length === 0">
            <td colspan="6">No products found</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="selectedGrn = null">Close</button>
    </div>
  </div>
</div>

<div class="dropdown">
  <button class="action-btn">Actions ▼</button>
  <div class="dropdown-content">
    <a href="javascript:void(0)" (click)="viewProducts(currentGrn)">View Products</a>
    <a href="javascript:void(0)" (click)="deleteGrn(currentGrn.id)">Delete</a>
  </div>
</div>

  <!-- Confirmation Modal -->
  <div class="modal" *ngIf="showDeleteModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Confirm Deletion</h3>
        <span class="close" (click)="cancelDelete()">&times;</span>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this Goods Received Note?</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="cancelDelete()">Cancel</button>
        <button class="btn btn-danger" (click)="confirmDelete()">Delete</button>
      </div>
    </div>
  </div>