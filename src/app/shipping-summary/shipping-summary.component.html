<div class="container-fluid p-4">
  <h2 class="mb-4 text-dark fw-semibold">Shipping Summary</h2>
  
  <div class="card mb-4 border">
    <div class="card-body">
      <h6 class="card-title mb-3 text-secondary">Date Filter</h6>
      <div class="row align-items-end">
        <div class="col-md-2">
          <label class="form-label small text-secondary mb-1">From Date</label>
          <div class="input-group">
            <input type="date" class="form-control" [(ngModel)]="startDate" (change)="applyFilters()">
            <span class="input-group-text">
              <i class="bi bi-calendar3"></i>
            </span>
          </div>
        </div>
        <div class="col-md-2">
          <label class="form-label small text-secondary mb-1">To Date</label>
          <div class="input-group">
            <input type="date" class="form-control" [(ngModel)]="endDate" (change)="applyFilters()">
            <span class="input-group-text">
              <i class="bi bi-calendar3"></i>
            </span>
          </div>
        </div>
        <div class="col-md-3">
          <button class="btn btn-primary me-2" (click)="applyFilters()">
            <i class="bi bi-funnel me-1"></i> Apply
          </button>
          <button class="btn btn-secondary" (click)="clearDateFilter()" *ngIf="dateFilterActive">
            <i class="bi bi-arrow-clockwise me-1"></i> Reset
          </button>
        </div>
        <div class="col-md-5 text-end">
          <button class="btn btn-success" (click)="exportToExcel()">
            <i class="bi bi-download me-1"></i> Export to Excel
          </button>
          <button class="btn btn-danger ms-2" (click)="exportToPDF()">
            <i class="bi bi-download me-1"></i> Export to PDF
          </button>
        </div>
      </div>
      
      <div class="mt-2" *ngIf="dateFilterActive">
        <small class="text-info">
          <i class="bi bi-info-circle me-1"></i>
          Date filter active: 
          <span *ngIf="startDate && endDate">{{startDate | date:'dd/MM/yyyy'}} to {{endDate | date:'dd/MM/yyyy'}}</span>
          <span *ngIf="startDate && !endDate">From {{startDate | date:'dd/MM/yyyy'}}</span>
          <span *ngIf="!startDate && endDate">Until {{endDate | date:'dd/MM/yyyy'}}</span>
          ({{filteredShipments.length}} records found)
        </small>
      </div>
    </div>
  </div>
   
  <div class="table-responsive">
    <table class="table table-hover mb-0" id="shippingTable">
      <thead class="table-light">
        <tr>
          <th class="fw-semibold text-dark">S.No</th>
          <th class="fw-semibold text-dark">
            Invoice Number <i class="bi bi-caret-up-fill ms-1"></i>
          </th>
          <th class="fw-semibold text-dark">Shipping Status</th>
          <th class="fw-semibold text-dark">
            Date <i class="bi bi-caret-down-fill ms-1"></i>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngIf="isLoading">
          <td colspan="4" class="text-center py-4 text-muted">
            <div class="spinner-border spinner-border-sm me-2"></div>
            Loading shipping data...
          </td>
        </tr>

        <tr *ngIf="!isLoading && filteredShipments.length === 0">
          <td colspan="4" class="text-center py-4 text-muted">
            <div class="d-flex flex-column align-items-center">
              <i class="bi bi-inbox display-6 text-muted mb-2"></i>
              <span *ngIf="!dateFilterActive && !searchTerm">No shipping data found</span>
              <span *ngIf="dateFilterActive || searchTerm">No records match your filter criteria</span>
              <small class="text-muted mt-1" *ngIf="dateFilterActive || searchTerm">
                Try adjusting your date range or search terms
              </small>
            </div>
          </td>
        </tr>

        <tr *ngFor="let shipment of filteredShipments | slice: (currentPage-1)*entriesPerPage : currentPage*entriesPerPage; let i = index" 
            [class]="i % 2 === 0 ? 'table-row-even' : 'table-row-odd'">
          <td class="fw-medium text-dark">{{(currentPage-1)*entriesPerPage + i + 1}}</td>
          <td class="text-primary fw-medium">{{shipment.invoiceNo}}</td>
          <td>
            <span [ngClass]="getStatusBadgeClass(shipment.shippingStatus)">
              {{shipment.shippingStatus}}
            </span>
          </td>
          <td class="fw-medium">{{shipment.date}}</td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <div class="d-flex justify-content-between align-items-center mt-3" *ngIf="filteredShipments.length > 0">
    <div class="d-flex align-items-center">
      <label class="me-2 text-secondary">Show</label>
      <select class="form-select form-select-sm" [(ngModel)]="entriesPerPage" (change)="currentPage = 1" style="width: auto;">
        <option value="5">5</option>
        <option value="10">10</option>
        <option value="25">25</option>
        <option value="50">50</option>
        <option value="100">100</option>
      </select>
      <label class="ms-2 text-secondary">entries</label>
    </div>
         
    <div class="d-flex align-items-center">
      <span class="me-3 text-secondary small">
        Showing {{((currentPage-1)*entriesPerPage) + 1}} to {{Math.min(currentPage*entriesPerPage, filteredShipments.length)}} of {{filteredShipments.length}} entries
        <span *ngIf="filteredShipments.length !== shipments.length" class="text-info">
          (filtered from {{shipments.length}} total entries)
        </span>
      </span>
      
      <button class="btn btn-sm btn-outline-secondary me-2"
               [disabled]="currentPage === 1"
               (click)="previousPage()">
        <i class="bi bi-chevron-left"></i> Previous
      </button>
      
      <span class="mx-2 text-secondary">
        Page {{ currentPage }} of {{ getTotalPages() }}
      </span>
      
      <button class="btn btn-sm btn-outline-secondary"
               [disabled]="currentPage >= getTotalPages()"
               (click)="nextPage()">
        Next <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </div>
</div>

<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete shipment with Invoice Number: <strong>{{ selectedShipment?.invoiceNo }}</strong>?
        <br><small class="text-muted">This action cannot be undone.</small>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" (click)="confirmDelete()" [disabled]="isDeleting">
          <span *ngIf="isDeleting" class="spinner-border spinner-border-sm mr-1"></span>
          Delete
        </button>
      </div>
    </div>
  </div>
</div>