<div class="container-fluid">
  <div class="card my-3">
    <div class="card-header bg-light py-3">
      <h4 class="mb-0">List Purchases</h4>
    </div>

    <div class="card-body">
      <!-- Filters Section -->
      <div class="row mb-3">
        <div class="col-12">
       
        </div>
      </div>

      <!-- All Purchases Section -->
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="mb-0">All Purchases</h5>
        <button class="btn btn-primary " [routerLink]="['/add-purchase']">
          <i class="fas fa-plus"></i> Add
        </button>
      </div>

      <!-- Export Options and Search -->
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div class="d-flex align-items-center">
          <label class="me-2">Show</label>
          <select class="form-select form-select-sm me-2" style="width: 70px;">
            <option>25</option>
            <option>50</option>
            <option>100</option>
          </select>
          <label>entries</label>
        </div>
        
        <div class="btn-group">
          <button class="btn btn-sm btn-outline-secondary" (click)="exportToCSV()">
            <i class="fas fa-file-csv me-1"></i> Export CSV
          </button>
          <button class="btn btn-sm btn-outline-secondary" (click)="exportToExcel()">
            <i class="fas fa-file-excel me-1"></i> Export Excel
          </button>
       
          <button class="btn btn-sm btn-outline-primary" (click)="toggleFilterSidebar()">
            <i class="fas fa-filter me-1"></i> Filter
          </button>
        </div>
        
        <div class="form-group mb-0">
          <input type="text" class="form-control form-control-sm" placeholder="Search ..." [(ngModel)]="searchText" (input)="applyFilter()">
        </div>
      </div>
      

<!-- Add the filter sidebar (place this at the bottom of your template) -->
<div class="filter-sidebar" [class.show]="showFilterSidebar">
  <div class="filter-header">
    <h5>Filter Purchases</h5>
    <button class="btn btn-sm btn-close" (click)="toggleFilterSidebar()"></button>
  </div>
  
  <div class="filter-body">
 <!-- Add this inside your filters section -->
<div class="row mb-3">
  <div class="col-12">
    <div class="btn-group btn-group-sm" role="group">
      <button type="button" class="btn btn-outline-secondary" (click)="setDateRange('today')">Today</button>
      <button type="button" class="btn btn-outline-secondary" (click)="setDateRange('yesterday')">Yesterday</button>
      <button type="button" class="btn btn-outline-secondary" (click)="setDateRange('last7days')">Last 7 Days</button>
      <button type="button" class="btn btn-outline-secondary" (click)="setDateRange('last30days')">Last 30 Days</button>
      <button type="button" class="btn btn-outline-secondary" (click)="setDateRange('lastMonth')">Last Month</button>
      <button type="button" class="btn btn-outline-secondary" (click)="setDateRange('thisMonth')">This Month</button>
      <button type="button" class="btn btn-outline-secondary" (click)="setDateRange('custom')">Custom Range</button>
    </div>
    
    <!-- Show custom date range picker only when custom is selected -->
    <div class="row mt-2" *ngIf="selectedDateRange === 'custom'">
      <div class="col-md-6">
        <label>From Date</label>
        <input type="date" class="form-control form-control-sm" [(ngModel)]="dateFilter.startDate">
      </div>
      <div class="col-md-6">
        <label>To Date</label>
        <input type="date" class="form-control form-control-sm" [(ngModel)]="dateFilter.endDate">
      </div>
    </div>
  </div>
</div>
    
    <div class="mb-3">
      <label class="form-label">Purchase Status</label>
      <select class="form-select form-select-sm" [(ngModel)]="statusFilter">
        <option value="">All Statuses</option>
        <option value="ordered">Ordered</option>
        <option value="pending">Pending</option>
        <option value="received">Received</option>
        <option value="cancelled">Cancelled</option>
      </select>
    </div>
    
    <div class="mb-3">
      <label class="form-label">Payment Status</label>
      <select class="form-select form-select-sm" [(ngModel)]="paymentStatusFilter">
        <option value="">All Statuses</option>
        <option value="paid">Paid</option>
        <option value="due">Due</option>
        <option value="partial">Partial</option>
      </select>
    </div>
   <div class="mb-3">
  <label class="form-label">Supplier</label>
  
  <!-- Search input for suppliers -->
  <input type="text" class="form-control form-control-sm mb-2" 
         [(ngModel)]="supplierSearchText" 
         (input)="filterSuppliers()"
         placeholder="Search suppliers...">
  
  <!-- Dropdown for filtered suppliers -->
  <select class="form-select form-select-sm" 
          [(ngModel)]="supplierFilter" 
          (ngModelChange)="applyAdvancedFilters()">
    <option value="">All Suppliers</option>
    <option *ngFor="let supplier of filteredSuppliers" [value]="supplier">
      {{supplier}}
    </option>
  </select>
</div>
    
    <div class="mb-3">
      <label class="form-label">Location</label>
      <select class="form-select form-select-sm" [(ngModel)]="locationFilter">
        <option value="">All Locations</option>
        <option *ngFor="let location of uniqueLocations" [value]="location">{{location}}</option>
      </select>
    </div>
  </div>
  
  <div class="filter-footer">
    <button class="btn btn-sm btn-secondary me-2" (click)="resetFilters()">
      Reset
    </button>
    <button class="btn btn-sm btn-primary" (click)="applyAdvancedFilters()">
      Apply Filters
    </button>
  </div>
</div>

<!-- Add overlay when sidebar is open -->
<div class="sidebar-overlay" [class.show]="showFilterSidebar" (click)="toggleFilterSidebar()"></div>
      <!-- Main Table -->
      <div class="table-responsive">
        <table class="table table-hover no-vertical-lines" id="purchaseTable">
      <!-- Update the table header section to include click events for sorting -->
<thead class="table-light">
  <tr>
    <th>Action <i class="fas fa-sort"></i></th>
    <th (click)="sortTable('date')">
      Date <i class="fas" [ngClass]="getSortIcon('date')"></i>
    </th>
    <th (click)="sortTable('referenceNo')">
      Reference No <i class="fas" [ngClass]="getSortIcon('referenceNo')"></i>
    </th>
    <th (click)="sortTable('invoiceNo')">
      Invoice No <i class="fas" [ngClass]="getSortIcon('invoiceNo')"></i>
    </th>

    <th (click)="sortTable('businessLocation')">
      To Location <i class="fas" [ngClass]="getSortIcon('businessLocation')"></i>
    </th>
 <th (click)="sortTable('supplier')">
      Supplier <i class="fas" [ngClass]="getSortIcon('supplier')"></i>
    </th>
 <th (click)="sortTable('supplierAddress')">
 From Address <i class="fas" [ngClass]="getSortIcon('supplierAddress')"></i>
</th>
    <th (click)="sortTable('purchaseStatus')">
      Purchase Status <i class="fas" [ngClass]="getSortIcon('purchaseStatus')"></i>
    </th>
    
    <th (click)="sortTable('paymentStatus')">
      Payment Status <i class="fas" [ngClass]="getSortIcon('paymentStatus')"></i>
    </th>
    <!-- In your table header section -->

    <!-- In your table header section -->
<!-- Add these columns to your table -->
<th (click)="sortTable('totalTax')">Tax (₹)</th>
<th (click)="sortTable('cgst')">CGST (₹)</th>
<th (click)="sortTable('sgst')">SGST (₹)</th>
<th (click)="sortTable('igst')">IGST (₹)</th>
<th (click)="sortTable('taxRate')">Tax Rate (%)</th>
    <th (click)="sortTable('grandTotal')">
      Grand Total <i class="fas" [ngClass]="getSortIcon('grandTotal')"></i>
    </th>
    <th (click)="sortTable('paymentAccount')">
  Payment Account <i class="fas" [ngClass]="getSortIcon('paymentAccount')"></i>
</th>
    <th (click)="sortTable('paymentDue')">
      Payment due <i class="fas fa-question-circle text-info"></i> 
      <i class="fas" [ngClass]="getSortIcon('paymentDue')"></i>
    </th>
 
    <th (click)="sortTable('addedBy')">
      Added By <i class="fas" [ngClass]="getSortIcon('addedBy')"></i>
    </th>
  </tr>
</thead>
          <tbody>
            <tr *ngIf="isLoading">
              <td colspan="12" class="text-center">
                <div class="spinner-border" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </td>
            </tr>
            
            <tr *ngFor="let purchase of filteredPurchases">
            <td>
  <!-- Action Button -->
  <button class="action-button" (click)="openActionPopup(purchase, $event)">Actions</button>

  <!-- Action Popup -->
  <div class="action-popup-overlay" *ngIf="currentActionPopup === purchase.id" (click)="closeActionPopup()">
    <div class="action-popup" (click)="$event.stopPropagation()">
      <div class="popup-header">
        <h4>Purchase #{{purchase.referenceNo}}</h4>
        <button class="close-btn" (click)="closeActionPopup()">&times;</button>
      </div>
      
      <div class="popup-body">
        <div class="action-item" (click)="viewPurchase(purchase); closeActionPopup()">
          <i class="fas fa-eye text-info"></i>
          <span>View</span>
        </div>
        
        <div class="action-item" (click)="editPurchase(purchase); closeActionPopup()">
          <i class="fas fa-edit text-primary"></i>
          <span>Edit</span>
        </div>
        
        <div class="action-item" (click)="addPayment(purchase); closeActionPopup()">
          <i class="fas fa-money-bill-wave text-success"></i>
          <span>Add Payment</span>
        </div>
        
        <div class="action-item" (click)="updateStatus(purchase); closeActionPopup()">
          <i class="fas fa-sync-alt text-info"></i>
          <span>Update Status</span>
        </div>
        
        <div class="action-item" (click)="openReturnModal(purchase); closeActionPopup()">
          <i class="fas fa-undo text-warning"></i>
          <span>Purchase Return</span>
        </div>
        
        <div class="action-item" (click)="printPurchase(purchase); closeActionPopup()">
          <i class="fas fa-print text-secondary"></i>
          <span>Print</span>
        </div>
        
        <div class="action-item" (click)="viewPayments(purchase); closeActionPopup()">
          <i class="fas fa-history text-secondary"></i>
          <span>View Payments</span>
        </div>
        
        <div class="divider"></div>
        
        <div class="action-item text-danger" (click)="confirmDelete(purchase); closeActionPopup()">
          <i class="fas fa-trash-alt"></i>
          <span>Delete</span>
        </div>
      </div>
    </div>
  </div>
</td>
              <td>{{ purchase.purchaseDate || 'N/A' }}</td>
              <td>{{ purchase.referenceNo || 'N/A' }}</td>
              <td>{{ purchase.invoiceNo || 'N/A' }}</td>
    <!-- Remove this column: <td>{{ getProductsDisplay(purchase.products) }}</td> -->
    <td>{{ purchase.businessLocation || 'N/A' }}</td>
              <td>{{ purchase.supplier|| 'N/A' }}</td>
              <td>{{ purchase.supplierAddress || 'N/A' }}</td>

              <td>
                <span [class]="getStatusClass(purchase.purchaseStatus)">
                  {{ purchase.purchaseStatus || 'Unknown' }}
                </span>
              </td>
              <td>{{ purchase.paymentStatus || 'Unknown' }}</td>
              <!-- In your table body section -->
              <!-- In your table body section -->
<td>₹ {{ purchase.totalTax?.toFixed(2) || '0.00' }}</td>
<td>₹ {{ purchase.cgst?.toFixed(2) || '0.00' }}</td>
<td>₹ {{ purchase.sgst?.toFixed(2) || '0.00' }}</td>
<td>₹ {{ purchase.igst?.toFixed(2) || '0.00' }}</td>
<td>{{ purchase.taxRate || '0' }}%</td>
<td class="text-end">
  ₹{{ purchase.grandTotal | number:'1.2-2' }}
</td><td>
  <div *ngIf="purchase.paymentAccount">
    {{ purchase.paymentAccount.name }}
    <small *ngIf="purchase.paymentAccount.accountNumber" class="text-muted d-block">
      {{ purchase.paymentAccount.accountNumber }}
    </small>
    <small *ngIf="purchase.paymentAccount.accountType" class="text-muted d-block">
      {{ purchase.paymentAccount.accountType }}
    </small>
  </div>
  <div *ngIf="!purchase.paymentAccount && purchase.paymentMethod">
    {{ purchase.paymentMethod }}
  </div>
  <div *ngIf="!purchase.paymentAccount && !purchase.paymentMethod">
    N/A
  </div>
</td>
    <td>₹ {{ purchase.paymentDue || '0.00' }}</td>

              <td>{{ purchase.addedBy || 'System' }}</td>
            </tr>
            
            <tr *ngIf="!isLoading && filteredPurchases.length === 0">
              <td colspan="12" class="text-center">No data available in table</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Totals Row -->
      <div class="table-responsive" *ngIf="!isLoading">
        <table class="table table-bordered">
          <tbody>
            <tr>
              <td class="fw-bold text-end" style="width: 20%">Total:</td>
              <td style="width: 10%"></td>
              <td style="width: 10%"></td>
              <td style="width: 10%"></td>
              <td style="width: 10%"></td>
              <td style="width: 10%"></td>
              <td style="width: 10%"></td>
              <td style="width: 10%">₹ {{ calculateTotal('grandTotal') }}</td>
                <td style="width: 10%">₹ {{ calculateTotal('totalTax') }}</td> <!-- New column -->

              <td style="width: 20%">
                <div>Purchase Due - ₹ {{ calculateTotal('paymentDue') }}</div>
                <div>Purchase Return - ₹ {{ calculateTotalReturns() }}</div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination and Summary -->
      <div class="row mt-3">
        <div class="col-md-6">
          <p>Showing {{ filteredPurchases.length > 0 ? '1' : '0' }} to {{ filteredPurchases.length }} of {{ purchases.length }} entries</p>
        </div>
        <div class="col-md-6">
          <nav aria-label="Page navigation" class="float-end">
            <ul class="pagination pagination-sm">
              <li class="page-item disabled">
                <a class="page-link" href="#" tabindex="-1">Previous</a>
              </li>
              <li class="page-item active"><a class="page-link" href="#">1</a></li>
              <li class="page-item disabled">
                <a class="page-link" href="#">Next</a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Return Modal -->
<div class="modal fade" id="returnModal" tabindex="-1" aria-labelledby="returnModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content return-modal-custom">
      <!-- Screen overlay when disabled -->
      <div class="screen-overlay" *ngIf="isDisabled">
        <div class="spinner-border text-primary overlay-spinner" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <div class="overlay-message" *ngIf="disabledMessage">{{disabledMessage}}</div>
      </div>
      
      <div class="modal-header return-modal-header">
        <h5 class="modal-title" id="returnModalLabel">
          <i class="fas fa-undo-alt me-2"></i>Return Purchase
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close" [disabled]="isDisabled"></button>
      </div>
      
      <div class="modal-body return-modal-body" [class.disabled-content]="isDisabled">
        <div *ngIf="selectedPurchase" class="return-form-container">
          <!-- Header Section -->
          <div class="row mb-4 header-section">
            <div class="col-md-6">
              <label class="form-label return-label">Purchase Reference:</label>
              <div class="return-reference-value">{{selectedPurchase.referenceNo}}</div>
            </div>
            <div class="col-md-6">
              <label class="form-label return-label">Return Date:</label>
              <input type="date" class="form-control return-date-input" 
                     [(ngModel)]="returnData.returnDate" [disabled]="isDisabled">
            </div>
          </div>

          <!-- Products Table -->
          <div class="table-responsive mb-4 return-products-table">
            <table class="table">
              <thead>
                <tr>
                  <th class="product-col">Product</th>
                  <th class="qty-col">Purchased Qty</th>
                  <th class="return-col">Return Qty</th>
                  <th class="price-col">Unit Price</th>
                  <th class="subtotal-col">Subtotal</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let product of selectedPurchase.products; let i = index">
                  <td class="product-name">{{ product.name || product.productName }}</td>
                  <td class="purchased-qty">{{ product.quantity }}</td>
                  <td class="return-qty-input">
                    <input type="number" class="form-control" 
                           [(ngModel)]="returnData.products[i].returnQuantity" 
                           (change)="calculateReturnSubtotal(i)"
                           min="0" [max]="product.quantity || 0" [disabled]="isDisabled">
                  </td>
                  <td class="unit-price">₹ {{ product.price | number:'1.2-2' }}</td>
                  <td class="subtotal">₹ {{ returnData.products[i].subtotal | number:'1.2-2' }}</td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Return Reason -->
          <div class="mb-4 return-reason-section">
            <label class="form-label return-label">Return Reason:</label>
            <textarea class="form-control return-reason-textarea" 
                      rows="3" 
                      placeholder="Please specify the reason for return..."
                      [(ngModel)]="returnData.reason" [disabled]="isDisabled"></textarea>
          </div>

          <!-- Status Section -->
          <div class="row mb-4 status-section">
            <div class="col-md-6 status-select">
              <label class="form-label return-label">Return Status:</label>
              <select class="form-select" [(ngModel)]="returnData.returnStatus" [disabled]="isDisabled">
                <option value="pending">Pending</option>
                <option value="completed">Completed</option>
                <option value="rejected">Rejected</option>
              </select>
            </div>
            <div class="col-md-6 status-select">
              <label class="form-label return-label">Payment Status:</label>
              <select class="form-select" [(ngModel)]="returnData.paymentStatus" [disabled]="isDisabled">
                <option value="pending">Pending</option>
                <option value="paid">Paid</option>
                <option value="partial">Partial</option>
              </select>
            </div>
          </div>

          <!-- Total Amount -->
          <div class="total-amount-section">
            <div class="total-amount-label">Total Return Amount:</div>
            <div class="total-amount-value">₹ {{ calculateTotalReturnAmount() | number:'1.2-2' }}</div>
          </div>
        </div>
      </div>

      <div class="modal-footer return-modal-footer">
        <button type="button" class="btn btn-cancel" data-bs-dismiss="modal" [disabled]="isDisabled">
          <i class="fas fa-times me-2"></i>Cancel
        </button>
        <button type="button" class="btn btn-submit" (click)="submitReturn()" [disabled]="isDisabled">
          <i class="fas fa-check me-2"></i>Submit Return
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Payment Modal -->
<div class="modal" [class.show]="showPaymentForm">
  <div class="modal-content payment-modal">
    <div class="modal-header">
      <h2>Add Payment</h2>
      <span class="close" (click)="closePaymentForm()">&times;</span>
    </div>
    
    <div class="modal-body">
      <form [formGroup]="paymentForm">
        <div class="form-row">
          <div class="form-group">
            <label>Reference No:</label>
            <input type="text" class="form-control" formControlName="referenceNo" readonly>
          </div>
          
          <div class="form-group">
            <label>Supplier:</label>
            <input type="text" class="form-control" formControlName="supplierName" readonly>
          </div>
        </div>
        
<div class="form-group">
  <label>Payment Account:*</label>
  <select class="form-control" formControlName="paymentAccount" required>
    <option value="">Select Payment Account</option>
    <option *ngFor="let account of paymentAccounts" [ngValue]="account"
            [disabled]="account.openingBalance <= 0">
      {{account.name}} ({{account.accountNumber}}) - ₹{{account.openingBalance | number:'1.2-2'}}
    </option>
  </select>
  <div *ngIf="paymentForm.get('paymentAccount')?.invalid && paymentForm.get('paymentAccount')?.touched" 
       class="error-message">
    Please select a payment account
  </div>
</div>
        
        <div class="form-group">
          <label>Payment Method:*</label>
          <div class="radio-group">
            <label class="radio-label">
              <input type="radio" formControlName="paymentMethod" value="Cash" checked> Cash
            </label>
            <label class="radio-label">
              <input type="radio" formControlName="paymentMethod" value="Bank Transfer"> Bank Transfer
            </label>
            <label class="radio-label">
              <input type="radio" formControlName="paymentMethod" value="Cheque"> Cheque
            </label>
            <label class="radio-label">
              <input type="radio" formControlName="paymentMethod" value="Other"> Other
            </label>
          </div>
        </div>
        
        <div class="amount-summary">
          <div class="summary-row">
            <span>Grand Total:</span>
            <span>₹ {{ currentPaymentPurchase?.grandTotal || '0.00' }}</span>
          </div>
          <div class="summary-row">
            <span>Paid Amount:</span>
            <span>₹ {{ currentPaymentPurchase?.paymentAmount || '0.00' }}</span>
          </div>
          <div class="summary-row highlight">
            <span>Balance Due:</span>
            <span>₹ {{ currentPaymentPurchase?.paymentDue || '0.00' }}</span>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label>Amount:*</label>
            <input 
              type="number" 
              class="form-control"
              formControlName="amount" 
              step="0.01" 
              min="0.01" 
              [max]="currentPaymentPurchase?.paymentDue || 0"
              required>
            <div *ngIf="paymentForm.get('amount')?.invalid && paymentForm.get('amount')?.touched" 
                 class="error-message">
              Please enter a valid amount
            </div>
          </div>
          
          <div class="form-group">
            <label>Paid on:*</label>
            <input 
              type="datetime-local" 
              class="form-control"
              formControlName="paidDate" 
              required>
            <div *ngIf="paymentForm.get('paidDate')?.invalid && paymentForm.get('paidDate')?.touched" 
                 class="error-message">
              Please select a date
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label>Payment Note:</label>
          <textarea 
            class="form-control"
            formControlName="paymentNote" 
            rows="3"></textarea>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="closePaymentForm()">Cancel</button>
          <button type="button" class="btn btn-primary" (click)="submitPayment()" 
                  [disabled]="paymentForm.invalid || paymentAccountsLoading">
            <span *ngIf="paymentAccountsLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            Save Payment
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
<div class="modal fade status-modal" id="statusModal" tabindex="-1" aria-labelledby="statusModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="statusModalLabel">
          <i class="fas fa-sync-alt me-2"></i>Update Purchase Status
        </h5><!-- Payment Modal -->
<div class="modal" [class.show]="showPaymentForm">
  <div class="modal-content payment-modal">
    <div class="modal-header">
      <h2>Add Payment</h2>
      <span class="close" (click)="closePaymentForm()">&times;</span>
    </div>
    
    <div class="modal-body">
      <form [formGroup]="paymentForm">
        <div class="form-row">
          <div class="form-group">
            <label>Reference No:</label>
            <input type="text" class="form-control" formControlName="referenceNo" readonly>
          </div>
          
          <div class="form-group">
            <label>Supplier:</label>
            <input type="text" class="form-control" formControlName="supplierName" readonly>
          </div>
        </div>
        
       <div class="form-group">
          <label>Payment Account:*</label>
          <select class="form-control" formControlName="paymentAccount" required>
            <option value="">Select Payment Account</option>
            <option *ngFor="let account of paymentAccounts" [ngValue]="account"
                    [disabled]="account.openingBalance <= 0">
              {{account.name}} ({{account.accountNumber}}) - ₹{{account.openingBalance | number:'1.2-2'}}
            </option>
          </select>
          <div *ngIf="paymentForm.get('paymentAccount')?.invalid && paymentForm.get('paymentAccount')?.touched" 
               class="error-message">
            Please select a payment account
          </div>
        </div>

        
        <div class="form-group">
          <label>Payment Method:*</label>
          <div class="radio-group">
            <label class="radio-label">
              <input type="radio" formControlName="paymentMethod" value="Cash" checked> Cash
            </label>
            <label class="radio-label">
              <input type="radio" formControlName="paymentMethod" value="Bank Transfer"> Bank Transfer
            </label>
            <label class="radio-label">
              <input type="radio" formControlName="paymentMethod" value="Cheque"> Cheque
            </label>
            <label class="radio-label">
              <input type="radio" formControlName="paymentMethod" value="Other"> Other
            </label>
          </div>
        </div>
        
        <div class="amount-summary">
          <div class="summary-row">
            <span>Grand Total:</span>
            <span>₹ {{ currentPaymentPurchase?.grandTotal || '0.00' }}</span>
          </div>
          <div class="summary-row">
            <span>Paid Amount:</span>
            <span>₹ {{ currentPaymentPurchase?.paymentAmount || '0.00' }}</span>
          </div>
          <div class="summary-row highlight">
            <span>Balance Due:</span>
            <span>₹ {{ currentPaymentPurchase?.paymentDue || '0.00' }}</span>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label>Amount:*</label>
            <input 
              type="number" 
              class="form-control"
              formControlName="amount" 
              step="0.01" 
              min="0.01" 
              [max]="currentPaymentPurchase?.paymentDue || 0"
              required>
            <div *ngIf="paymentForm.get('amount')?.invalid && paymentForm.get('amount')?.touched" 
                 class="error-message">
              Please enter a valid amount
            </div>
          </div>
          
          <div class="form-group">
            <label>Paid on:*</label>
            <input 
              type="datetime-local" 
              class="form-control"
              formControlName="paidDate" 
              required>
            <div *ngIf="paymentForm.get('paidDate')?.invalid && paymentForm.get('paidDate')?.touched" 
                 class="error-message">
              Please select a date
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label>Payment Note:</label>
          <textarea 
            class="form-control"
            formControlName="paymentNote" 
            rows="3"></textarea>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="closePaymentForm()">Cancel</button>
          <button type="button" class="btn btn-primary" (click)="submitPayment()" 
                  [disabled]="paymentForm.invalid || paymentAccountsLoading">
            <span *ngIf="paymentAccountsLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            Save Payment
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div *ngIf="selectedPurchaseForStatus">
          
          
          <div class="form-group">
            <label class="form-label">Current Status:</label>
            <div>
              <span class="status-badge" [ngClass]="selectedPurchaseForStatus.purchaseStatus">
                {{ selectedPurchaseForStatus.purchaseStatus | titlecase }}
              </span>
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">New Status:</label>
            <div class="status-options">
              <div class="status-option">
                <input type="radio" id="status-ordered" name="newStatus" value="ordered" [(ngModel)]="newPurchaseStatus">
                <label for="status-ordered" class="ordered">
                  <i class="fas fa-shopping-cart me-1"></i>Ordered
                </label>
              </div>
              
              <div class="status-option">
                <input type="radio" id="status-pending" name="newStatus" value="pending" [(ngModel)]="newPurchaseStatus">
                <label for="status-pending" class="pending">
                  <i class="fas fa-clock me-1"></i>Pending
                </label>
              </div>
              
              <div class="status-option">
                <input type="radio" id="status-received" name="newStatus" value="received" [(ngModel)]="newPurchaseStatus">
                <label for="status-received" class="received">
                  <i class="fas fa-check-circle me-1"></i>Received
                </label>
              </div>
            </div>
          </div>
          
     
        </div>
      </div>
      <div class="modal-footer">
  <button type="button" class="btn btn-secondary" (click)="closeCurrentModal()">
    <i class="fas fa-times me-1"></i>Cancel
  </button>
  <button type="button" class="btn btn-primary" (click)="updatePurchaseStatus()">
    <i class="fas fa-save me-1"></i>Update Status
  </button>
</div>
    </div>
  </div>
</div>